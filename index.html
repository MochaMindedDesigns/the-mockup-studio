<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol{margin:0;padding:0}table td,table th{padding:0}.c1{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c3{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c2{height:11pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c3 doc-content"><p class="c0"><span class="c1">&lt;!DOCTYPE html&gt;</span></p><p class="c0"><span class="c1">&lt;html lang=&quot;en&quot;&gt;</span></p><p class="c0"><span class="c1">&lt;head&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;meta charset=&quot;UTF-8&quot; /&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;title&gt;Mocha Minded Designs Mockup Studio&lt;/title&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; </span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;!-- Polyfill for Import Maps --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;script async src=&quot;https://ga.jspm.io/npm:es-module-shims@1.10.0/dist/es-module-shims.js&quot;&gt;&lt;/script&gt;</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;!-- Import Map for ES Modules in the browser --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;script type=&quot;importmap&quot;&gt;</span></p><p class="c0"><span class="c1">{</span></p><p class="c0"><span class="c1">&nbsp; &quot;imports&quot;: {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &quot;react&quot;: &quot;https://esm.sh/react@18.2.0&quot;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &quot;react-dom/client&quot;: &quot;https://esm.sh/react-dom@18.2.0/client&quot;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &quot;jszip&quot;: &quot;https://esm.sh/jszip@3.10.1&quot;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &quot;@google/genai&quot;: &quot;https://aistudiocdn.com/@google/genai@^1.17.0&quot;</span></p><p class="c0"><span class="c1">&nbsp; }</span></p><p class="c0"><span class="c1">}</span></p><p class="c0"><span class="c1">&lt;/script&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; </span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;!-- Tailwind CSS --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;script src=&quot;https://cdn.tailwindcss.com&quot;&gt;&lt;/script&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;script&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; tailwind.config = {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; content: [&quot;./index.html&quot;],</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; theme: {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; extend: {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; colors: {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;mocha-dark&#39;: &#39;#2E2522&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;mocha-med&#39;: &#39;#6F5E53&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;mocha-light&#39;: &#39;#A58E7F&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;cream&#39;: &#39;#F5EFE6&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;latte&#39;: &#39;#E8D5C4&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fontFamily: {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sans: [&#39;ui-sans-serif&#39;, &#39;system-ui&#39;]</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; },</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; plugins: [],</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;/script&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; </span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;!-- Babel for in-browser JSX/TSX transpilation --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;script src=&quot;https://unpkg.com/@babel/standalone/babel.min.js&quot;&gt;&lt;/script&gt;</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&lt;/head&gt;</span></p><p class="c0"><span class="c1">&lt;body class=&quot;bg-cream text-mocha-dark font-sans&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; </span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;!-- All application code consolidated here --&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;script type=&quot;text/babel&quot; data-type=&quot;module&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; import React from &#39;react&#39;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; import ReactDOM from &#39;react-dom/client&#39;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; import JSZip from &#39;jszip&#39;;</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; // ===== CONSTANTS =====</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const PRODUCT_CATEGORIES = {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;Apparel&#39;: [&#39;T-Shirt&#39;, &#39;Hoodie&#39;, &#39;Sweatshirt&#39;, &#39;Tank Top&#39;, &#39;Long Sleeve Shirt&#39;, &#39;Crop Top&#39;, &#39;Polo Shirt&#39;, &#39;Jacket&#39;, &#39;Leggings&#39;, &#39;Shorts&#39;, &#39;Kids T-Shirt&#39;, &#39;Baby Onesie&#39;],</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;Bags &amp; Accessories&#39;: [&#39;Tote Bag&#39;, &#39;Backpack&#39;, &#39;Phone Case&#39;, &#39;Cap&#39;, &#39;Beanie&#39;, &#39;Scarf&#39;, &#39;Socks&#39;, &#39;Fanny Pack&#39;],</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;Drinkware&#39;: [&#39;Mug&#39;, &#39;Tumbler&#39;, &#39;Water Bottle&#39;, &#39;Can Cooler&#39;, &#39;Wine Glass&#39;, &#39;Beer Stein&#39;],</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;Home &amp; Wall&#39;: [&#39;Canvas Print&#39;, &#39;Poster&#39;, &#39;Pillow&#39;, &#39;Towel&#39;, &#39;Blanket&#39;, &#39;Coaster&#39;, &#39;Doormat&#39;, &#39;Apron&#39;],</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;Seasonal&#39;: [&#39;Ornament&#39;, &#39;Stocking&#39;, &#39;Ugly Christmas Sweater&#39;, &#39;Beach Towel&#39;],</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;Stationery&#39;: [&#39;Notebook&#39;, &#39;Greeting Card&#39;, &#39;Sticker&#39;, &#39;Journal&#39;, &#39;Bookmark&#39;, &#39;Enamel Pin&#39;],</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;Tech&#39;: [&#39;Laptop Sleeve&#39;, &#39;Mouse Pad&#39;, &#39;Tablet Case&#39;, &#39;AirPods Case&#39;],</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const STYLES = [&#39;Angle&#39;, &#39;Flat Lay&#39;, &#39;Studio&#39;, &#39;Lifestyle-Lite&#39;, &#39;Seasonal&#39;];</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const MODEL_GENDERS = [&#39;Male&#39;, &#39;Female&#39;, &#39;Unisex&#39;, &#39;Boy&#39;, &#39;Girl&#39;];</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const MODEL_ETHNICITIES = [&#39;Asian&#39;, &#39;Black&#39;, &#39;Caucasian&#39;, &#39;Hispanic&#39;, &#39;Middle Eastern&#39;, &#39;South Asian&#39;, &#39;Pacific Islander&#39;, &#39;Indigenous&#39;, &#39;Mixed&#39;];</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const PREDEFINED_COLORS = [</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;#ffffff&#39;, &#39;#000000&#39;, &#39;#f44336&#39;, &#39;#e91e63&#39;, &#39;#9c27b0&#39;, &#39;#673ab7&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;#3f51b5&#39;, &#39;#2196f3&#39;, &#39;#03a9f4&#39;, &#39;#00bcd4&#39;, &#39;#009688&#39;, &#39;#4caf50&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;#8bc34a&#39;, &#39;#cddc39&#39;, &#39;#ffeb3b&#39;, &#39;#ffc107&#39;, &#39;#ff9800&#39;, &#39;#ff5722&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; ];</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const EXPORT_PRESETS = {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;Etsy&#39;: { width: 2700, height: 2700 },</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;Shopify&#39;: { width: 2048, height: 2048 },</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;Instagram Post&#39;: { width: 1080, height: 1080 },</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;Instagram Story&#39;: { width: 1080, height: 1920 },</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;Pinterest&#39;: { width: 1000, height: 1500 },</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;Amazon&#39;: { width: 2000, height: 2000},</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;Custom&#39;: { width: 1024, height: 1024},</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; // ===== SERVICES =====</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; // --- geminiService ---</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; // This function now acts as a client to our own backend proxy.</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; async function callBackendApi(task, params) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const response = await fetch(&#39;/api/gemini&#39;, {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; method: &#39;POST&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; headers: { &#39;Content-Type&#39;: &#39;application/json&#39; },</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; body: JSON.stringify({ task, params }),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!response.ok) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const errorData = await response.json();</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new Error(errorData.error || &#39;API request failed&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return response.json();</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; async function generateMockupImage(prompt, numberOfImages) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const { images } = await callBackendApi(&#39;generateImage&#39;, { prompt, numberOfImages });</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return images; // The backend now returns an array of base64 strings</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const dataUrlToParts = (dataUrl) =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const parts = dataUrl.split(&#39;,&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const mimeType = parts[0].match(/:(.*?);/)?.[1] || &#39;image/png&#39;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const data = parts[1];</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return { mimeType, data };</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; async function removeImageBackground(designDataUrl) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const { mimeType, data } = dataUrlToParts(designDataUrl);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const { image } = await callBackendApi(&#39;removeBackground&#39;, { mimeType, data });</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return image; // Backend returns the full data URL string</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; async function applyDesignToMockup(blankMockupBase64, designDataUrl, productName) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const { mimeType: designMimeType, data: designBase64 } = dataUrlToParts(designDataUrl);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const { image } = await callBackendApi(&#39;applyDesign&#39;, {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; blankMockupBase64,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; designMimeType,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; designBase64,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; productName,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return image; // Backend returns just the base64 data</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; async function generateSeoListing(productName, designDescription) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const { content } = await callBackendApi(&#39;generateSeo&#39;, { productName, designDescription });</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return content;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; async function generateAltText(imageDataUrl) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const { mimeType, data } = dataUrlToParts(imageDataUrl);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const { text } = await callBackendApi(&#39;generateAltText&#39;, { mimeType, data });</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return text;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; // --- exportService ---</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const getExportDimensions = (settings) =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (settings.preset === &#39;Custom&#39;) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return { width: settings.customWidth, height: settings.customHeight };</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return EXPORT_PRESETS[settings.preset] || EXPORT_PRESETS[&#39;Etsy&#39;];</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const resizeCanvasToBlob = (canvas, width, height) =&gt; new Promise((resolve) =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const resizedCanvas = document.createElement(&#39;canvas&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; resizedCanvas.width = width;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; resizedCanvas.height = height;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const ctx = resizedCanvas.getContext(&#39;2d&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!ctx) { resolve(null); return; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.drawImage(canvas, 0, 0, width, height);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; resizedCanvas.toBlob(resolve, &#39;image/png&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const downloadCanvasAsImage = async (canvas, filename, settings) =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const { width, height } = getExportDimensions(settings);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const blob = await resizeCanvasToBlob(canvas, width, height);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!blob) { console.error(&quot;Could not create blob from canvas&quot;); return; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const link = document.createElement(&#39;a&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; link.href = URL.createObjectURL(blob);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; link.download = filename;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.body.appendChild(link);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; link.click();</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.body.removeChild(link);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; URL.revokeObjectURL(link.href);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const createImageFromDataURL = (dataURL) =&gt; new Promise((resolve, reject) =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const image = new Image();</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; image.crossOrigin = &#39;anonymous&#39;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; image.onload = () =&gt; resolve(image);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; image.onerror = reject;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; image.src = dataURL;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const applyWatermarkAndGetBlob = async (baseImage, settings, watermarkState) =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const canvas = document.createElement(&#39;canvas&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; canvas.width = baseImage.width; canvas.height = baseImage.height;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const ctx = canvas.getContext(&#39;2d&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!ctx) return null;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.drawImage(baseImage, 0, 0);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (watermarkState.image) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; try {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const wmImage = await createImageFromDataURL(watermarkState.image);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.globalAlpha = watermarkState.opacity;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const scale = 0.15;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const w = canvas.width * scale; const h = (w / wmImage.width) * wmImage.height;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let x = (canvas.width - w) / 2; let y = (canvas.height - h) / 2;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const margin = 20;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (watermarkState.position === &#39;topLeft&#39;) { x = margin; y = margin; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (watermarkState.position === &#39;topRight&#39;) { x = canvas.width - w - margin; y = margin; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (watermarkState.position === &#39;bottomLeft&#39;) { x = margin; y = canvas.height - h - margin; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (watermarkState.position === &#39;bottomRight&#39;) { x = canvas.width - w - margin; y = canvas.height - h - margin; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.drawImage(wmImage, x, y, w, h);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.globalAlpha = 1.0;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } catch (error) { console.error(&quot;Failed to load watermark image for zip export&quot;, error); }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const { width, height } = getExportDimensions(settings);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return resizeCanvasToBlob(canvas, width, height);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const downloadImagesAsZip = async (images, zipFilename, settings, watermark) =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const zip = new JSZip();</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const imageElements = await Promise.all(images.map(createImageFromDataURL));</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (let i = 0; i &lt; imageElements.length; i++) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const blob = await applyWatermarkAndGetBlob(imageElements[i], settings, watermark);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (blob) { zip.file(`mockup-${i + 1}.png`, blob); }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (imageElements.length &gt; 0) { zip.file(&quot;readme.txt&quot;, &quot;This is your Etsy Mockup Set, generated by Mocha Minded Designs Mockup Studio.&quot;); }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const zipBlob = await zip.generateAsync({ type: &#39;blob&#39; });</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const link = document.createElement(&#39;a&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; link.href = URL.createObjectURL(zipBlob);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; link.download = zipFilename;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.body.appendChild(link);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; link.click();</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.body.removeChild(link);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; URL.revokeObjectURL(link.href);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; // ===== ICONS =====</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const CoffeeIcon = ({ className }) =&gt; (&lt;svg className={className} xmlns=&quot;http://www.w3.org/2000/svg&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;currentColor&quot;&gt;&lt;path strokeLinecap=&quot;round&quot; strokeLinejoin=&quot;round&quot; strokeWidth={2} d=&quot;M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z&quot; /&gt;&lt;/svg&gt;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const UploadIcon = ({ className }) =&gt; (&lt;svg className={className} xmlns=&quot;http://www.w3.org/2000/svg&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;currentColor&quot;&gt;&lt;path strokeLinecap=&quot;round&quot; strokeLinejoin=&quot;round&quot; strokeWidth={2} d=&quot;M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12&quot; /&gt;&lt;/svg&gt;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const LoadingIcon = ({ className }) =&gt; (&lt;svg className={className} xmlns=&quot;http://www.w3.org/2000/svg&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;circle className=&quot;opacity-25&quot; cx=&quot;12&quot; cy=&quot;12&quot; r=&quot;10&quot; stroke=&quot;currentColor&quot; strokeWidth=&quot;4&quot;&gt;&lt;/circle&gt;&lt;path className=&quot;opacity-75&quot; fill=&quot;currentColor&quot; d=&quot;M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const DownloadIcon = ({ className }) =&gt; (&lt;svg className={className} xmlns=&quot;http://www.w3.org/2000/svg&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;currentColor&quot;&gt;&lt;path strokeLinecap=&quot;round&quot; strokeLinejoin=&quot;round&quot; strokeWidth={2} d=&quot;M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4&quot; /&gt;&lt;/svg&gt;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const ZipIcon = ({ className }) =&gt; (&lt;svg className={className} xmlns=&quot;http://www.w3.org/2000/svg&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;currentColor&quot; strokeWidth=&quot;2&quot;&gt;&lt;path strokeLinecap=&quot;round&quot; strokeLinejoin=&quot;round&quot; d=&quot;M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13&quot; /&gt;&lt;/svg&gt;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const SparklesIcon = ({ className }) =&gt; (&lt;svg className={className} xmlns=&quot;http://www.w3.org/2000/svg&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;currentColor&quot; strokeWidth=&quot;2&quot;&gt;&lt;path strokeLinecap=&quot;round&quot; strokeLinejoin=&quot;round&quot; d=&quot;M5 3v4M3 5h4M6.225 6.225L8.65 8.65m5.475-5.475L15.775 5M12 20v-4M10 18h4m-1.5-1.5L15 14m-5-5l2.5-2.5&quot; /&gt;&lt;/svg&gt;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const AltTextIcon = ({ className }) =&gt; (&lt;svg className={className} xmlns=&quot;http://www.w3.org/2000/svg&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;currentColor&quot; strokeWidth=&quot;2&quot;&gt;&lt;path strokeLinecap=&quot;round&quot; strokeLinejoin=&quot;round&quot; d=&quot;M4 6h16M4 12h16M4 18h7&quot; /&gt;&lt;/svg&gt;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const PositionTopLeft = ({ className }) =&gt; &lt;svg className={className} viewBox=&quot;0 0 24 24&quot; fill=&quot;currentColor&quot;&gt;&lt;path d=&quot;M4 4h6v6H4z&quot;/&gt;&lt;/svg&gt;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const PositionTopRight = ({ className }) =&gt; &lt;svg className={className} viewBox=&quot;0 0 24 24&quot; fill=&quot;currentColor&quot;&gt;&lt;path d=&quot;M14 4h6v6h-6z&quot;/&gt;&lt;/svg&gt;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const PositionCenter = ({ className }) =&gt; &lt;svg className={className} viewBox=&quot;0 0 24 24&quot; fill=&quot;currentColor&quot;&gt;&lt;path d=&quot;M9 9h6v6H9z&quot;/&gt;&lt;/svg&gt;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const PositionBottomLeft = ({ className }) =&gt; &lt;svg className={className} viewBox=&quot;0 0 24 24&quot; fill=&quot;currentColor&quot;&gt;&lt;path d=&quot;M4 14h6v6H4z&quot;/&gt;&lt;/svg&gt;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const PositionBottomRight = ({ className }) =&gt; &lt;svg className={className} viewBox=&quot;0 0 24 24&quot; fill=&quot;currentColor&quot;&gt;&lt;path d=&quot;M14 14h6v6h-6z&quot;/&gt;&lt;/svg&gt;;</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; // ===== COMPONENTS =====</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const Header = () =&gt; (</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;header className=&quot;bg-mocha-dark text-cream p-4 shadow-md&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;container mx-auto flex items-center justify-between&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;flex items-center space-x-3&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;CoffeeIcon className=&quot;w-8 h-8 text-latte&quot; /&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h1 className=&quot;text-xl md:text-2xl font-bold tracking-wider&quot;&gt;Mocha Minded Designs Mockup Studio&lt;/h1&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/header&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; );</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const Section = ({ title, children }) =&gt; (</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;space-y-3&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h3 className=&quot;text-sm font-bold text-mocha-med uppercase tracking-wider&quot;&gt;{title}&lt;/h3&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {children}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; );</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const FileInput = ({ id, label, onChange, file }) =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const handleFileChange = (e) =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (e.target.files &amp;&amp; e.target.files[0]) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const reader = new FileReader();</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reader.onload = (event) =&gt; { onChange(event.target?.result); };</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reader.readAsDataURL(e.target.files[0]);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return (</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label htmlFor={id} className=&quot;cursor-pointer bg-white border border-mocha-light rounded-md p-3 flex items-center justify-center text-mocha-med hover:bg-latte/50 transition-colors&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;UploadIcon className=&quot;w-5 h-5 mr-2&quot; /&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span&gt;{file ? &quot;Change&quot; : &quot;Upload&quot;} {label}&lt;/span&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/label&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input id={id} type=&quot;file&quot; accept=&quot;image/png, image/jpeg&quot; className=&quot;hidden&quot; onChange={handleFileChange} /&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {file &amp;&amp; &lt;img src={file} alt={`${label} preview`} className=&quot;mt-2 rounded-md max-h-20 object-contain mx-auto&quot; /&gt;}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const ControlPanel = ({ controlState, setControlState, onGenerate, isLoading }) =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const handleStateChange = React.useCallback((key, value) =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setControlState(prevState =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const newState = { ...prevState, [key]: value };</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (key === &#39;productCategory&#39;) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newState.product = PRODUCT_CATEGORIES[value][0];</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return newState;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }, [setControlState]);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const productOptions = React.useMemo(() =&gt; PRODUCT_CATEGORIES[controlState.productCategory] || [], [controlState.productCategory]);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return (</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;bg-white p-4 rounded-lg shadow-lg space-y-6 h-full&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;Section title=&quot;1. Your Design&quot;&gt;&lt;FileInput id=&quot;design-upload&quot; label=&quot;Your Artwork&quot; file={controlState.design} onChange={file =&gt; handleStateChange(&#39;design&#39;, file)} /&gt;&lt;/Section&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;Section title=&quot;2. Product &amp; Style&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select value={controlState.productCategory} onChange={e =&gt; handleStateChange(&#39;productCategory&#39;, e.target.value)} className=&quot;w-full p-2 border border-mocha-light rounded-md bg-white focus:ring-2 focus:ring-mocha-med&quot;&gt;&lt;option value=&quot;&quot; disabled&gt;Category&lt;/option&gt;{Object.keys(PRODUCT_CATEGORIES).map(cat =&gt; &lt;option key={cat} value={cat}&gt;{cat}&lt;/option&gt;)}&lt;/select&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select value={controlState.product} onChange={e =&gt; handleStateChange(&#39;product&#39;, e.target.value)} className=&quot;w-full p-2 border border-mocha-light rounded-md bg-white focus:ring-2 focus:ring-mocha-med&quot;&gt;&lt;option value=&quot;&quot; disabled&gt;Product&lt;/option&gt;{productOptions.map(prod =&gt; &lt;option key={prod} value={prod}&gt;{prod}&lt;/option&gt;)}&lt;/select&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select value={controlState.style} onChange={e =&gt; handleStateChange(&#39;style&#39;, e.target.value)} className=&quot;w-full p-2 border border-mocha-light rounded-md bg-white focus:ring-2 focus:ring-mocha-med&quot;&gt;{STYLES.map(style =&gt; &lt;option key={style} value={style}&gt;{style}&lt;/option&gt;)}&lt;/select&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/Section&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;Section title=&quot;3. Customization&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label className=&quot;block text-xs font-medium text-mocha-med mb-1&quot;&gt;Product Color&lt;/label&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;flex items-center space-x-2&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;color&quot; value={controlState.productColor} onChange={e =&gt; handleStateChange(&#39;productColor&#39;, e.target.value)} className=&quot;w-10 h-10 p-1 border border-mocha-light rounded-md&quot; /&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;text&quot; value={controlState.productColor} onChange={e =&gt; handleStateChange(&#39;productColor&#39;, e.target.value)} className=&quot;w-full p-2 border border-mocha-light rounded-md bg-white focus:ring-2 focus:ring-mocha-med&quot; placeholder=&quot;#ffffff&quot;/&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;grid grid-cols-6 gap-2 mt-2&quot;&gt;{PREDEFINED_COLORS.map(color =&gt; (&lt;button key={color} onClick={() =&gt; handleStateChange(&#39;productColor&#39;, color)} className={`w-full h-8 rounded border ${controlState.productColor === color ? &#39;ring-2 ring-offset-2 ring-mocha-med&#39; : &#39;border-mocha-light&#39;}`} style={{ backgroundColor: color }} /&gt;))}&lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {controlState.productCategory === &#39;Apparel&#39; &amp;&amp; (&lt;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select value={controlState.modelGender} onChange={e =&gt; handleStateChange(&#39;modelGender&#39;, e.target.value)} className=&quot;w-full p-2 border border-mocha-light rounded-md bg-white focus:ring-2 focus:ring-mocha-med&quot;&gt;{MODEL_GENDERS.map(g =&gt; &lt;option key={g} value={g}&gt;{g}&lt;/option&gt;)}&lt;/select&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select value={controlState.modelEthnicity} onChange={e =&gt; handleStateChange(&#39;modelEthnicity&#39;, e.target.value)} className=&quot;w-full p-2 border border-mocha-light rounded-md bg-white focus:ring-2 focus:ring-mocha-med&quot;&gt;{MODEL_ETHNICITIES.map(e =&gt; &lt;option key={e} value={e}&gt;{e}&lt;/option&gt;)}&lt;/select&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/&gt;)}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;flex space-x-2&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button onClick={() =&gt; handleStateChange(&#39;background&#39;, &#39;white&#39;)} className={`flex-1 p-2 rounded-md text-sm ${controlState.background === &#39;white&#39; ? &#39;bg-mocha-dark text-white&#39; : &#39;bg-gray-200&#39;}`}&gt;White BG&lt;/button&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button onClick={() =&gt; handleStateChange(&#39;background&#39;, &#39;styled&#39;)} className={`flex-1 p-2 rounded-md text-sm ${controlState.background === &#39;styled&#39; ? &#39;bg-mocha-dark text-white&#39; : &#39;bg-gray-200&#39;}`}&gt;Styled BG&lt;/button&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;FileInput id=&quot;bg-upload&quot; label=&quot;Custom BG&quot; file={controlState.customBackground} onChange={file =&gt; { handleStateChange(&#39;customBackground&#39;, file); if(file) handleStateChange(&#39;background&#39;, &#39;custom&#39;) }} /&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/Section&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button onClick={onGenerate} disabled={isLoading || !controlState.design} className=&quot;w-full bg-mocha-med text-white font-bold py-3 px-4 rounded-md hover:bg-mocha-dark transition-colors disabled:bg-mocha-light disabled:cursor-not-allowed&quot;&gt;{isLoading ? &#39;Generating...&#39; : &#39;Generate 4 Mockups&#39;}&lt;/button&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const PreviewPanel = React.forwardRef(({ baseImages, watermark, isLoading, loadingMessage, activeIndex, setActiveIndex }, ref) =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const canvasRef = React.useRef(null);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const activeImageSrc = baseImages &amp;&amp; baseImages.length &gt; 0 ? baseImages[activeIndex] : null;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; React.useEffect(() =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const canvas = canvasRef.current;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!canvas) return;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const ctx = canvas.getContext(&#39;2d&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!ctx) return;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!activeImageSrc) { ctx.clearRect(0, 0, canvas.width, canvas.height); return; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const base = new Image();</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; base.crossOrigin = &quot;anonymous&quot;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; base.onload = () =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; canvas.width = base.width; canvas.height = base.height;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.drawImage(base, 0, 0);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; drawWatermark();</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; base.src = activeImageSrc;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const drawWatermark = () =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const afterWatermarkDrawn = () =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (ref &amp;&amp; &#39;current&#39; in ref &amp;&amp; ref.current) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const destCtx = ref.current.getContext(&#39;2d&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(destCtx) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ref.current.width = canvas.width; ref.current.height = canvas.height;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destCtx.drawImage(canvas, 0, 0);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (watermark.image) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const wm = new Image();</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wm.crossOrigin = &quot;anonymous&quot;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wm.onload = () =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.globalAlpha = watermark.opacity;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const scale = 0.15; const w = canvas.width * scale; const h = (w / wm.width) * wm.height;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let x = (canvas.width - w) / 2; let y = (canvas.height - h) / 2; const margin = 20;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (watermark.position === &#39;topLeft&#39;) { x = margin; y = margin; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (watermark.position === &#39;topRight&#39;) { x = canvas.width - w - margin; y = margin; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (watermark.position === &#39;bottomLeft&#39;) { x = margin; y = canvas.height - h - margin; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (watermark.position === &#39;bottomRight&#39;) { x = canvas.width - w - margin; y = canvas.height - h - margin; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.drawImage(wm, x, y, w, h);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ctx.globalAlpha = 1.0;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; afterWatermarkDrawn();</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wm.src = watermark.image;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else { afterWatermarkDrawn(); }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }, [activeImageSrc, watermark, ref]);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return (</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;bg-white p-4 rounded-lg shadow-lg flex flex-col justify-between aspect-square h-full&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;flex-grow flex items-center justify-center relative min-h-0&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {isLoading &amp;&amp; (&lt;div className=&quot;text-center text-mocha-med&quot;&gt;&lt;LoadingIcon className=&quot;w-12 h-12 mx-auto animate-spin&quot; /&gt;&lt;p className=&quot;mt-4 font-semibold&quot;&gt;{loadingMessage}&lt;/p&gt;&lt;/div&gt;)}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {!isLoading &amp;&amp; (!baseImages || baseImages.length === 0) &amp;&amp; (</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;text-center text-mocha-light p-8&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;p className=&quot;font-semibold text-lg&quot;&gt;Your Mockup Preview&lt;/p&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;p&gt;Upload your design and click &quot;Generate 4 Mockups&quot; to see them here.&lt;/p&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;canvas ref={canvasRef} className={`max-w-full max-h-full object-contain ${isLoading || !activeImageSrc ? &#39;hidden&#39; : &#39;&#39;}`} /&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {baseImages &amp;&amp; baseImages.length &gt; 0 &amp;&amp; !isLoading &amp;&amp; (&lt;div className=&quot;flex-shrink-0 pt-4&quot;&gt;&lt;div className=&quot;flex items-center justify-center gap-2&quot;&gt;{baseImages.map((image, index) =&gt; (&lt;button key={index} onClick={() =&gt; setActiveIndex(index)} className={`w-16 h-16 rounded-md overflow-hidden border-2 ${index === activeIndex ? &#39;border-mocha-med&#39; : &#39;border-transparent&#39;}`}&gt;&lt;img src={image} alt={`Mockup thumbnail ${index + 1}`} className=&quot;w-full h-full object-cover&quot;/&gt;&lt;/button&gt;))}&lt;/div&gt;&lt;/div&gt;)}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;canvas ref={ref} className=&quot;hidden&quot; /&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const MarketingPanel = ({ watermark, setWatermark, seoContent, altText, onGenerateSeo, onGenerateAltText, isLoading, mockupGenerated, onDownload, onBatchExport, exportSettings, setExportSettings }) =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const handleWatermarkFileChange = (e) =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (e.target.files &amp;&amp; e.target.files[0]) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const reader = new FileReader();</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reader.onload = (event) =&gt; setWatermark(prev =&gt; ({ ...prev, image: event.target?.result }));</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reader.readAsDataURL(e.target.files[0]);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const handleWatermarkOpacityChange = (e) =&gt; setWatermark(prev =&gt; ({...prev, opacity: parseFloat(e.target.value)}));</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const handleWatermarkPositionChange = (position) =&gt; setWatermark(prev =&gt; ({...prev, position}));</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const handleExportPresetChange = (e) =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const preset = e.target.value;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const dimensions = EXPORT_PRESETS[preset] || {width: 1024, height: 1024};</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setExportSettings({ preset, customWidth: dimensions.width, customHeight: dimensions.height });</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return (</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;bg-white p-4 rounded-lg shadow-lg space-y-6 h-full&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;space-y-3&quot;&gt;&lt;h3 className=&quot;text-sm font-bold text-mocha-med uppercase tracking-wider&quot;&gt;Watermark&lt;/h3&gt;&lt;div className=&quot;p-4 bg-latte/30 rounded-md space-y-3&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label htmlFor=&quot;watermark-upload&quot; className=&quot;cursor-pointer w-full bg-white border border-mocha-light rounded-md p-3 flex items-center justify-center text-mocha-med hover:bg-latte/50 transition-colors&quot;&gt;&lt;UploadIcon className=&quot;w-5 h-5 mr-2&quot; /&gt;&lt;span&gt;{watermark.image ? &quot;Change Watermark&quot; : &quot;Upload Watermark&quot;}&lt;/span&gt;&lt;/label&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input id=&quot;watermark-upload&quot; type=&quot;file&quot; accept=&quot;image/png&quot; className=&quot;hidden&quot; onChange={handleWatermarkFileChange} /&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {watermark.image &amp;&amp; (&lt;&gt;&lt;label className=&quot;text-xs font-medium text-mocha-med&quot;&gt;Opacity: {Math.round(watermark.opacity * 100)}%&lt;/label&gt;&lt;input type=&quot;range&quot; min=&quot;0&quot; max=&quot;1&quot; step=&quot;0.05&quot; value={watermark.opacity} onChange={handleWatermarkOpacityChange} className=&quot;w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-mocha-med&quot;/&gt;&lt;div className=&quot;flex justify-between&quot;&gt;{[{ pos: &#39;topLeft&#39;, icon: &lt;PositionTopLeft className=&quot;w-5 h-5&quot;/&gt; }, { pos: &#39;topRight&#39;, icon: &lt;PositionTopRight className=&quot;w-5 h-5&quot;/&gt; }, { pos: &#39;center&#39;, icon: &lt;PositionCenter className=&quot;w-5 h-5&quot;/&gt; }, { pos: &#39;bottomLeft&#39;, icon: &lt;PositionBottomLeft className=&quot;w-5 h-5&quot;/&gt; }, { pos: &#39;bottomRight&#39;, icon: &lt;PositionBottomRight className=&quot;w-5 h-5&quot;/&gt; }].map(({pos, icon}) =&gt; (&lt;button key={pos} onClick={() =&gt; handleWatermarkPositionChange(pos)} className={`p-2 rounded ${watermark.position === pos ? &#39;bg-mocha-med text-white&#39; : &#39;bg-white&#39;}`}&gt;{icon}&lt;/button&gt;))}&lt;/div&gt;&lt;/&gt;)}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;&lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;space-y-3&quot;&gt;&lt;h3 className=&quot;text-sm font-bold text-mocha-med uppercase tracking-wider&quot;&gt;Auto-Generate Listings&lt;/h3&gt;&lt;div className=&quot;p-4 bg-latte/30 rounded-md space-y-3&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button onClick={onGenerateSeo} disabled={!mockupGenerated || isLoading} className=&quot;w-full flex items-center justify-center gap-2 bg-mocha-med text-white font-bold py-2 px-4 rounded-md hover:bg-mocha-dark transition-colors disabled:bg-mocha-light disabled:cursor-not-allowed&quot;&gt;&lt;SparklesIcon className=&quot;w-5 h-5&quot; /&gt; Generate SEO Listing&lt;/button&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {seoContent &amp;&amp; (&lt;div className=&quot;text-xs space-y-2 max-h-48 overflow-y-auto p-2 bg-white rounded-md&quot;&gt;&lt;p&gt;&lt;strong&gt;Title:&lt;/strong&gt; {seoContent.title}&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Description:&lt;/strong&gt; {seoContent.description}&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Features:&lt;/strong&gt; {seoContent.features.join(&#39;, &#39;)}&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Tags:&lt;/strong&gt; {seoContent.tags.join(&#39;, &#39;)}&lt;/p&gt;&lt;/div&gt;)}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button onClick={onGenerateAltText} disabled={!mockupGenerated || isLoading} className=&quot;w-full flex items-center justify-center gap-2 bg-mocha-med text-white font-bold py-2 px-4 rounded-md hover:bg-mocha-dark transition-colors disabled:bg-mocha-light disabled:cursor-not-allowed&quot;&gt;&lt;AltTextIcon className=&quot;w-5 h-5&quot; /&gt; Generate Alt Text&lt;/button&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {altText.length &gt; 0 &amp;&amp; (&lt;div className=&quot;text-xs space-y-2 max-h-48 overflow-y-auto p-2 bg-white rounded-md&quot;&gt;{altText.map((text, index) =&gt; (&lt;p key={index}&gt;&lt;strong&gt;Image {index + 1}:&lt;/strong&gt; {text}&lt;/p&gt;))}&lt;/div&gt;)}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;&lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;space-y-3&quot;&gt;&lt;h3 className=&quot;text-sm font-bold text-mocha-med uppercase tracking-wider&quot;&gt;Export&lt;/h3&gt;&lt;div className=&quot;p-4 bg-latte/30 rounded-md space-y-3&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select value={exportSettings.preset} onChange={handleExportPresetChange} className=&quot;w-full p-2 border border-mocha-light rounded-md bg-white focus:ring-2 focus:ring-mocha-med&quot;&gt;{Object.keys(EXPORT_PRESETS).map(p =&gt; &lt;option key={p} value={p}&gt;{p}&lt;/option&gt;)}&lt;/select&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {exportSettings.preset === &#39;Custom&#39; &amp;&amp; (&lt;div className=&quot;flex gap-2&quot;&gt;&lt;input type=&quot;number&quot; value={exportSettings.customWidth} onChange={(e) =&gt; setExportSettings(s=&gt;({...s, customWidth: parseInt(e.target.value, 10)}))} placeholder=&quot;Width&quot; className=&quot;w-1/2 p-2 border border-mocha-light rounded-md&quot;/&gt;&lt;input type=&quot;number&quot; value={exportSettings.customHeight} onChange={(e) =&gt; setExportSettings(s=&gt;({...s, customHeight: parseInt(e.target.value, 10)}))} placeholder=&quot;Height&quot; className=&quot;w-1/2 p-2 border border-mocha-light rounded-md&quot;/&gt;&lt;/div&gt;)}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button onClick={onDownload} disabled={!mockupGenerated || isLoading} className=&quot;w-full flex items-center justify-center gap-2 bg-mocha-med text-white font-bold py-2 px-4 rounded-md hover:bg-mocha-dark transition-colors disabled:bg-mocha-light disabled:cursor-not-allowed&quot;&gt;&lt;DownloadIcon className=&quot;w-5 h-5&quot; /&gt; Download Mockup&lt;/button&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button onClick={onBatchExport} disabled={!mockupGenerated || isLoading} className=&quot;w-full flex items-center justify-center gap-2 bg-mocha-med text-white font-bold py-2 px-4 rounded-md hover:bg-mocha-dark transition-colors disabled:bg-mocha-light disabled:cursor-not-allowed&quot;&gt;&lt;ZipIcon className=&quot;w-5 h-5&quot; /&gt; Export Images (ZIP)&lt;/button&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;&lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; // ===== APP COMPONENT =====</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; function App() {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const [controlState, setControlState] = React.useState({ design: null, productCategory: &#39;Apparel&#39;, product: &#39;T-Shirt&#39;, style: &#39;Studio&#39;, productColor: &#39;#ffffff&#39;, modelGender: &#39;Female&#39;, modelEthnicity: &#39;Caucasian&#39;, background: &#39;white&#39;, customBackground: null });</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const [watermark, setWatermark] = React.useState({ image: null, opacity: 0.5, position: &#39;center&#39; });</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const [exportSettings, setExportSettings] = React.useState({ preset: &#39;Etsy&#39;, customWidth: 2700, customHeight: 2700 });</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const [mockupImages, setMockupImages] = React.useState([]);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const [seoContent, setSeoContent] = React.useState(null);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const [altText, setAltText] = React.useState([]);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const [isLoading, setIsLoading] = React.useState(false);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const [loadingMessage, setLoadingMessage] = React.useState(&#39;&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const [error, setError] = React.useState(&#39;&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const [activeIndex, setActiveIndex] = React.useState(0);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const finalCanvasRef = React.useRef(null);</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const handleGenerateMockup = React.useCallback(async () =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setIsLoading(true); setError(&#39;&#39;); setMockupImages([]); setActiveIndex(0);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let backgroundDescription = &#39;a clean white background&#39;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (controlState.background === &#39;styled&#39;) backgroundDescription = `a styled background that complements a ${controlState.style} product photo`;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else if (controlState.background === &#39;custom&#39; &amp;&amp; controlState.customBackground) backgroundDescription = &#39;a background that is visually appealing and suitable for a product mockup, complementing the product color&#39;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const isChildModel = controlState.modelGender === &#39;Boy&#39; || controlState.modelGender === &#39;Girl&#39;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const modelAge = isChildModel ? `a child ${controlState.modelGender.toLowerCase()}` : `an adult ${controlState.modelGender.toLowerCase()}`;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const modelDescription = controlState.productCategory === &#39;Apparel&#39; ? ` with ${modelAge} ${controlState.modelEthnicity} model. The model&#39;s face should not be fully visible, cropped from the nose or neck down to keep the focus on the product.` : &#39;&#39;;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const prompt = `A high-quality, photorealistic ${controlState.style} mockup of a blank product: a ${controlState.productColor} ${controlState.product}. No text or logos on the product. The scene is set on ${backgroundDescription}${modelDescription}.`;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; try {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setLoadingMessage(&#39;Generating 4 photorealistic mockups...&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const blankMockupsBase64 = await generateMockupImage(prompt, 4);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let finalMockups = blankMockupsBase64;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let finalMockupDataUrls = finalMockups.map(img =&gt; `data:image/png;base64,${img}`);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (controlState.design) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setLoadingMessage(&#39;Removing background from your design...&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const designWithTransparentBg = await removeImageBackground(controlState.design);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setLoadingMessage(&#39;Applying your design to 4 mockups...&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const appliedDesignsBase64 = await Promise.all(</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; blankMockupsBase64.map(blankMockup =&gt; </span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; applyDesignToMockup(blankMockup, designWithTransparentBg, controlState.product)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; finalMockupDataUrls = appliedDesignsBase64.map(img =&gt; `data:image/png;base64,${img}`);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setMockupImages(finalMockupDataUrls);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } catch (e) { console.error(e); setError(e.message || &#39;Failed to generate mockups. Please try again.&#39;); } </span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; finally { setIsLoading(false); setLoadingMessage(&#39;&#39;); }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }, [controlState]);</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const handleGenerateSeo = React.useCallback(async () =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (mockupImages.length === 0 || !controlState.design) { setError(&#39;Please generate mockups and upload a design first.&#39;); return; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setIsLoading(true); setLoadingMessage(&#39;Generating SEO content...&#39;); setError(&#39;&#39;); setSeoContent(null);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; try {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const content = await generateSeoListing(controlState.product, &#39;a custom user-provided design&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setSeoContent(content);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } catch (e) { console.error(e); setError(&#39;Failed to generate SEO content.&#39;); } </span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; finally { setIsLoading(false); setLoadingMessage(&#39;&#39;); }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }, [mockupImages, controlState.product, controlState.design]);</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const handleGenerateAltText = React.useCallback(async () =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (mockupImages.length === 0) { setError(&#39;Please generate mockups first.&#39;); return; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setIsLoading(true); setLoadingMessage(`Generating alt text for ${mockupImages.length} images...`); setError(&#39;&#39;); setAltText([]);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; try {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const texts = await Promise.all(mockupImages.map(image =&gt; generateAltText(image)));</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setAltText(texts);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } catch (e) { console.error(e); setError(&#39;Failed to generate alt text.&#39;); } </span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; finally { setIsLoading(false); setLoadingMessage(&#39;&#39;); }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }, [mockupImages]);</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const handleDownload = () =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (finalCanvasRef.current) downloadCanvasAsImage(finalCanvasRef.current, `mockup-${activeIndex + 1}.png`, exportSettings);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else setError(&quot;Preview canvas not available for download.&quot;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const handleBatchExport = async () =&gt; {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (mockupImages.length &gt; 0) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setIsLoading(true); setLoadingMessage(&#39;Exporting images...&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; await downloadImagesAsZip(mockupImages, &#39;Mockup-Images.zip&#39;, exportSettings, watermark);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setIsLoading(false); setLoadingMessage(&#39;&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else { setError(&quot;No mockups available for batch export.&quot;); }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return (</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;min-h-screen bg-cream font-sans&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;Header /&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;main className=&quot;p-4 lg:p-8&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;grid grid-cols-1 lg:grid-cols-12 gap-8&quot;&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;lg:col-span-3&quot;&gt;&lt;ControlPanel controlState={controlState} setControlState={setControlState} onGenerate={handleGenerateMockup} isLoading={isLoading} /&gt;&lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;lg:col-span-6&quot;&gt;&lt;PreviewPanel ref={finalCanvasRef} baseImages={mockupImages} watermark={watermark} isLoading={isLoading} loadingMessage={loadingMessage} activeIndex={activeIndex} setActiveIndex={setActiveIndex} /&gt;&lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div className=&quot;lg:col-span-3&quot;&gt;&lt;MarketingPanel watermark={watermark} setWatermark={setWatermark} seoContent={seoContent} altText={altText} onGenerateSeo={handleGenerateSeo} onGenerateAltText={handleGenerateAltText} isLoading={isLoading} mockupGenerated={mockupImages.length &gt; 0} onDownload={handleDownload} onBatchExport={handleBatchExport} exportSettings={exportSettings} setExportSettings={setExportSettings}/&gt;&lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {error &amp;&amp; (&lt;div className=&quot;fixed bottom-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg max-w-sm&quot;&gt;&lt;p&gt;&lt;strong&gt;Error:&lt;/strong&gt; {error}&lt;/p&gt;&lt;button onClick={() =&gt; setError(&#39;&#39;)} className=&quot;absolute top-1 right-2 text-white font-bold&quot;&gt;&amp;times;&lt;/button&gt;&lt;/div&gt;)}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/main&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; // ===== RENDER APP =====</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const rootElement = document.getElementById(&#39;root&#39;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; if (!rootElement) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new Error(&quot;Could not find root element to mount to&quot;);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; const root = ReactDOM.createRoot(rootElement);</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; root.render(&lt;App /&gt;);</span></p><p class="c0 c2"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &lt;/script&gt;</span></p><p class="c0"><span class="c1">&lt;/body&gt;</span></p><p class="c0"><span class="c1">&lt;/html&gt;</span></p><p class="c0 c2"><span class="c1"></span></p></body></html>